<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      Badging API
    </title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c" class=
    "remove"></script>
    <script class='remove'>
       var respecConfig = {
        specStatus: "unofficial",
        github: {
          repoURL: "w3c/badging",
          branch: "main"
        },
        group: "webapps",
        editors: [{
          name: "Matt Giuca",
          company: "Google Inc.",
          companyURL: "https://google.com"
        },
        {
          name: "Marcos Cáceres",
          company: "Apple Inc.",
          companyURL: "https://apple.com",
          w3cid: 78903
        },
        {
          name: "Jay Harris",
          retiredDate: "2019-12-31"
        }],
        latestVersion: null,
        // mdn: true, (not available yet)
        xref: "web-platform",
      };
    </script>
  </head>
  <body data-cite="appmanifest">
    <section id="abstract">
      <p>
        This specification defines an API allowing [=installed web
        applications=] to set an application badge, which is usually shown in
        an operating-system-specific place associated with the application
        (such as the shelf, dock, or home screen).
      </p>
    </section>
    <section id="sotd">
      <p>
        This is an early draft of the Badging API spec.
      </p>
    </section>
    <section class="informative">
      <h2>
        Usage examples
      </h2>
      <pre class="example javascript" title=
      "Showing unread count on the app icon">
        function pollForMail() {
          // ... Fetch unread mail from server. ...

          // Set the app badge.
          navigator.setAppBadge(getUnreadCount());
        }
      </pre>
      <p>
        The badge might show up on the application's icon in the operating
        system. If multiple API calls within the same application [=set=] or
        [=clear=] a badge, the most recent one takes effect, and may continue
        being seen even after an application is closed.
      </p>
      <pre class="example javascript" title=
      "Showing ready status on the app icon">
        function showPlayerTurn(playerTurnId) {
          if (playerTurnId === localPlayerId)
            navigator.setAppBadge();
          else
            navigator.clearAppBadge();
        }
      </pre>
    </section>
    <section>
      <h2>
        Badge model
      </h2>
      <p>
        A <dfn>badge</dfn> is intended as a light-weight mechanism for
        applications to subtly notify the user that there is some new activity
        that might require their attention, or as a way of indicating a small
        amount of information, such as an unread count.
      </p>
      <p>
        An [=installed web application=] has an associated [=badge=], which is
        initialized to [="nothing"=].
      </p>
      <p>
        A [=badge=] can have one of the following <dfn data-dfn-for=
        "badge">values</dfn>:
      </p>
      <dl>
        <dt>
          The special value <dfn>"nothing"</dfn>:
        </dt>
        <dd>
          Indicates that there is no badge currently [=set=].
        </dd>
        <dt>
          The special value <dfn>"flag"</dfn>:
        </dt>
        <dd>
          Indicates that the badge is [=set=], but contains no specific value.
        </dd>
        <dt>
          A <dfn>number</dfn> value:
        </dt>
        <dd>
          Indicates that the badge is [=set=] to a numerical value greater than
          `0`.
        </dd>
      </dl>
    </section>
    <section id="presentation">
      <h2>
        Displaying a badge
      </h2>
      <p>
        When the application's badge is <dfn>set</dfn>, the user agent SHOULD
        display the application's badge alongside any iconic representations of
        the application in the user's operating system (for example, as a small
        overlay on top of the application's icon).
      </p>
      <p>
        When the [=badge=] is [=set=] to [="flag"=], the user agent SHOULD show
        an indicator with a non-specific symbol (such as a coloured circle).
      </p>
      <p>
        When the [=badge=] is set to a [=number=], it SHOULD be formatted
        according to the user's locale settings. For example, the badge content
        '7' should be displayed as '7' in the locale 'en-NZ' (English as spoken
        in New Zealand) but as '٧' in 'ar-EG' (Arabic as spoken in Egypt).
        Furthermore, the user agent MAY simplify or degrade a badge's
        [=number=] [=badge/value=] in any way. For example, a large number can
        be saturated (for example, as "99+"). The font and formatting are
        entirely at the user agent's or host operating system's discretion,
        ideally to match user preferences. The user agent MAY ignore a badge's
        [=badge/value=] and show a marker when the status is [=set=].
      </p>
      <p>
        When a [=badge=]'s value is [=set=] to [="nothing"=], it SHOULD be
        <dfn data-local-lt="clearing|clear">cleared</dfn>: removing any
        application badge that is currently being displayed.
      </p>
    </section>
    <section data-dfn-for="NavigatorBadge">
      <h2>
        Extensions to the `Navigator` and `WorkerNavigator` interfaces
      </h2>
      <pre class="idl">
        [SecureContext]
        interface mixin NavigatorBadge {
          Promise&lt;undefined&gt; setAppBadge(
            optional [EnforceRange] unsigned long long contents
          );
          Promise&lt;undefined&gt; clearAppBadge();
        };

        Navigator includes NavigatorBadge;
        WorkerNavigator includes NavigatorBadge;
      </pre>
      <h3>
        <dfn>setAppBadge()</dfn> method
      </h3>
      <p>
        When the {{NavigatorBadge/setAppBadge()}} method is called, the user
        agent MUST [=set the application badge=] of [=this=] to value of the
        |contents:unsigned long long| argument.
      </p>
      <h3>
        <dfn>clearAppBadge()</dfn> method
      </h3>
      <p>
        When the {{NavigatorBadge/clearAppBadge()}} method is called, the user
        agent MUST [=set the application badge=] of [=this=] to 0.
      </p>
    </section>
    <section>
      <h2>
        Setting the application badge
      </h2>
      <p>
        To <dfn>set the application badge</dfn> of platform object [=this=] to
        an optional {{unsigned long long}} |contents:unsigned long long| value:
      </p>
      <ol>
        <li>Let |global| be [=this=]'s [=relevant global object=].
        </li>
        <li>If |global| is a {{Window}} object, then:
          <ol>
            <li>Let |document| be |global|'s [=associated `Document`=].
            </li>
            <li>If |document| is not [=Document/fully active=], return [=a
            promise rejected with=] a {{InvalidStateError}}.
            </li>
          </ol>
        </li>
        <li>Let |environment| be |global|'s [=environment settings object=].
        </li>
        <li>Let |appId| be the |environment|'s [=environment settings
        object/appId=].
        </li>
        <li>If |appId| is null, return [=a promise resolved with=] `undefined`.
        </li>
        <li>If the |environment|'s [=environment settings object/origin=] is
        not [=same origin=] with with |appId|, return [=a promise rejected
        with=] a {{SecurityError}}.
        </li>
        <li>Let |badge| be the [=badge=] associated with |appId|.
        </li>
        <li>Return [=a promise resolved with=] undefined, and [=in parallel=]:
          <ol>
            <li>Switching on |contents|, if it happens to be the case that:
              <dl class="switch">
                <dt>
                  |contents| was not passed:
                </dt>
                <dd>
                  [=Set=] |badge| to [="flag"=].
                </dd>
                <dt>
                  |contents| is 0:
                </dt>
                <dd>
                  [=Set=] the [=badge=] to [="nothing"=] and [=clear=] it.
                </dd>
                <dt>
                  Default:
                </dt>
                <dd>
                  [=Set=] |badge| to |contents|.
                </dd>
              </dl>
            </li>
          </ol>
        </li>
      </ol>
    </section>
    <section>
      <h2>
        Security and privacy considerations
      </h2>
      <p>
        The API is write-only by design. There is no way for a site to read
        back the value of a badge that was previously set, to ensure that the
        application badge cannot be used as a storage or fingerprinting
        mechanism.
      </p>
      <p>
        The user agent MAY [=clear=] a [=badge=] at its discretion, and to
        follow any system conventions (for example, when the system is reset).
      </p>
      <aside class="issue" data-number="68"></aside>
    </section>
    <section class="informative">
      <h2>
        Accessibility considerations
      </h2>
      <div class="issue" data-number="24"></div>
    </section>
    <section id="conformance"></section>
  </body>
</html>
